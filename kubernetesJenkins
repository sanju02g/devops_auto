pipeline{
    agent any
environment{
  dockerimagename= "nginx/latest"
  dockerimage= ""
}
    stages{
        stage("git checkout stage"){
            steps{
                git url:'https://github.com/sanju02g/devops_auto.git' , branch:'kubernetes'
            }
        }
       stage("create docker image") {
            steps {
                script {
                    sh "cd ansible"
                    dockerimage = docker.build("sanju02g/demo:latest")
                }
            }
        }
        stage("docker image push") {
            steps {
             environment {
              dockerregistry: "dockercredentials"
             }
                script {
                    docker.withRegistry( 'https://registry.hub.docker.com', dockerregistry ) {
                    dockerimage.push("latest")
                }
            }
        }
}
}
}
