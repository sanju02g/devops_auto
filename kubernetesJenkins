pipeline{
    agent any
environment{
  dockerimagename= "nginx/latest"
  dockerimage= ""
}
    stages{
        stage("git checkout stage"){
            steps{
                git url:'https://github.com/sanju02g/devops_auto.git' , branch:'kubernetes'
            }
        }
       stage("create docker image") {
            steps {
                script {
                    sh "cd ansible"
                    dockerimage = docker.build("sanju02g/nginx")
                }
            }
        }
        stage("docker image push") {
             environment {
              dockerregistry= "dockercredentials"
             }
            steps{
                script {
                    docker.withRegistry( 'https://registry.hub.docker.com', dockerregistry ) {
                    dockerimage.push("latest")
                }
            }
        }
      }
     stage('Deploying App to Kubernetes') {
      steps {
        script {
          kubernetesDeploy(configs: "deploymentservice.yml", kubeconfigId: "kubernetes")
        }
      }
    }
}
}
